#!/bin/sh
set -e
MAX=$((100*1024*1024))  # 100 MB
# проверяем только то, что сейчас staged
git diff --cached --name-only -z | while IFS= read -r -d '' f; do
  [ -f "$f" ] || continue
  sz=$(wc -c < "$f" | tr -d ' ')
  if [ "$sz" -gt "$MAX" ]; then
    echo "ERROR: staged file is larger than 100MB: $f ($sz bytes)"
    echo "Tip: move backups/builds out of repo or add to .gitignore"
    exit 1
  fi
done
